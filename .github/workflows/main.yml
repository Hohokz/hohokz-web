name: Deploy Next.js Static to GitHub Pages

on:
  push:
    branches:
      - main  # ‡∏´‡∏£‡∏∑‡∏≠ branch ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å ‡πÄ‡∏ä‡πà‡∏ô master
  workflow_dispatch:

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout üõéÔ∏è
        uses: actions/checkout@v4
      
      # ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Node.js
      - name: Setup Node üì¶
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'npm' # ‡πÉ‡∏ä‡πâ cache ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö npm packages
          
      # ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á dependencies
      - name: Install dependencies üõ†Ô∏è
        run: npm install

      # Build ‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå (‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå 'out')
      - name: Build project üèóÔ∏è
        run: npm run build
        env:
          NODE_ENV: production # ‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤ basePath ‡∏ñ‡∏π‡∏Å‡∏ô‡∏≥‡∏°‡∏≤‡πÉ‡∏ä‡πâ

      # Deploy ‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå 'out' ‡πÑ‡∏õ‡∏¢‡∏±‡∏á GitHub Pages
      - name: Deploy to GitHub Pages üöÄ
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./out # ‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà Next.js export ‡∏≠‡∏≠‡∏Å‡∏°‡∏≤
          # publish_branch: gh-pages # (Optional) deploy ‡πÑ‡∏õ‡∏ó‡∏µ‡πà branch ‡∏ä‡∏∑‡πà‡∏≠ gh-pages
